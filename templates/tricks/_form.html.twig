{{ form_start(trickForm) }}
        <section>
                <img style="width: 100%;height: 90vh;object-fit: cover;" 
                    src="/assets/img/img.png">
                <div class="position-absolute top-50 start-50 translate-middle bg-light rounded p-5" style="--bs-bg-opacity: .8;">
                    {{ form_label(trickForm.name) }}
                    {{ form_widget(trickForm.name) }}
                </div>
        </section>


        <section class="container">

            {# on affiche les images si on est en édition #}
            {% if app.request.attributes.get('_route') == 'app_tricks_edit' %}
                <div class="d-flex flex-wrap justify-content-center m-2">

                    {% if images is not empty or videos is not empty %}

                        {% if images|length > 0 %}
                            {% for img in images %}
                                <div class="m-2 d-flex flex-column">
                                    <img src="/assets/img/tricks/{{ img.name }}"
                                        style="height:300px; width:400px; object-fit:cover;"
                                        alt="{{ img.name }}">
                                        <div>      
                                            <a href="#" class="btn btn-secondary"><i class="fa-solid fa-pen"></i></a>
                                            <a href="{{ path('app_tricks_delete_image', {id: img.id}) }}" data-delete data-token="{{ csrf_token('delete' ~ img.id) }}" class="btn btn-danger"><i class="fa-solid fa-trash"></i></a>
                                            <a href="#" class="btn btn-success">Mettre à la une</a>
                                        </div>
                                </div>
                            {% endfor %}
                        {% endif %}

                        {% if videos|length > 0 %}
                            {% for vdo in videos %}
                                <div class="m-2">
                                    <iframe height="300px" width="400px" src="{{ vdo.url|replace({'watch?v=': 'embed/'}) }}" frameborder="0" allowfullscreen></iframe>
                                    <div>    
                                        <a href="#" class="btn btn-secondary"><i class="fa-solid fa-pen"></i></a>
                                        <a href="" class="btn btn-danger"><i class="fa-solid fa-trash"></i></a>
                                    </div>    
                                </div>
                            {% endfor %}
                        {% endif %}

                    {% else %}
                        <div class="d-flex flex-column justify-content-center">
                            <p> Il n'y a pas encore d'images ou de vidéos pour ce trick !</p>
                        </div>

                    {% endif %}

                </div>
            {% endif %}
            
             <div class="col-12 mt-4">
                {{ form_label(trickForm.images) }}
                {{ form_widget(trickForm.images) }}
            </div>
            
            <div class="col-12 mt-4">
            <label>Ajouter des vidéos</label>
                <div id="videos-container">
                    <div class="video-input mb-2">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <span class="input-group-text rounded-0">https://</span>
                            </div>
                            <input type="text"
                                id="videos[]"
                                name="videos[]"
                                value=""
                                placeholder="Entrez une url"
                                class="form-control video-url">
                            <div class="input-group-append">
                                <button type="button" id="delete-btn" class="btn btn-danger delete-video">Supprimer</button>
                            </div>
                        </div>
                    </div>
                </div>
                <button id="add-video" class="btn btn-primary mt-3">Ajouter une autre vidéo</button>

                <div class="d-none">{{ form_widget(trickForm.videos) }}</div> 
            </div>
        </section>

        <hr class="m-5">

        <section class="container">
            <section class="row mb-4">
                <div class="col-12">
                    {{ form_label(trickForm.description) }}
                    {{ form_widget(trickForm.description) }}
                </div>
            </section>

            <section class="row">
                <div class="col-6">
                    {{ form_label(trickForm.category) }}
                    {{ form_widget(trickForm.category) }}
                </div>
                <div class="d-flex justify-content-center mt-5">
                    <button type="submit" class="btn btn-primary">{{ button_label|default('Ajouter') }}</button>                
                </div>
            </section>
        </section>

    {{ form_end(trickForm) }}

 <script>
    document.addEventListener('DOMContentLoaded', function () {
        var addVideoButton = document.getElementById('add-video');
        var videosContainer = document.getElementById('videos-container');

        addVideoButton.addEventListener('click', function (event) {
            event.preventDefault();
            var lastInput = videosContainer.querySelector('.video-input:last-child');
            var clone = lastInput.cloneNode(true);
            var lastInputId = lastInput.querySelector('.video-url').id;
            var newId = lastInputId.replace(/\d+/g, function(match) {
                return parseInt(match) + 1;
            });
            clone.querySelector('.video-url').id = newId;
            clone.querySelector('.video-url').name = newId;
            clone.querySelector('.video-url').value = '';
            clone.querySelector('.video-url').disabled = false;
            videosContainer.appendChild(clone);

            var deleteButton = clone.querySelector('.delete-video');
            deleteButton.textContent = 'Supprimer';
            deleteButton.classList.remove('btn-success');
            deleteButton.classList.add('btn-danger');
        });

        videosContainer.addEventListener('click', function (event) {
            event.preventDefault();
            if (event.target.classList.contains('delete-video')) {
                var videoInput = event.target.closest('.video-input');
                var videoUrlInput = videoInput.querySelector('.video-url');
                if (videoUrlInput.disabled) {
                    videoUrlInput.disabled = false;
                    event.target.textContent = 'Supprimer';
                    event.target.classList.remove('btn-success');
                    event.target.classList.add('btn-danger');
                } else {
                    videoUrlInput.disabled = true;
                    event.target.textContent = 'Restaurer';
                    event.target.classList.remove('btn-danger');
                    event.target.classList.add('btn-success');
                }
            }
        });
    });
</script>

